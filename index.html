<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Charmaine's Tiendita</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="auction-container">
        <!-- Store Name Section -->
        <header>
            <h1>Charmaine's Tiendita!</h1>
            <h2>Welcome to my store!</h2>
        </header>

        <h3>Thank you for visiting my website. I coded it from scratch. All bids are placed in Peso format. Have fun! And don't forget to come back. I will try to update the website daily.<br>
            Gracias por visitar mi sitio web. Lo codifiqué desde cero. Todas las ofertas se realizan en formato Peso. ¡Diviértete!</h3>

        <div id="product-listing">
            <!-- Product 1 -->
            <div class="product" id="product-tv">
                <h2>Item 1: Television</h2>
                <p>Description: An element TV with an Amazon HDMI.</p>
                <img src="/images/tv.jpeg" alt="Television" class="product-image">
                <p id="current-bid-tv">Current Bid: <span>$0</span></p>
                
                <div id="timer-tv">
                    <span id="countdown-tv"></span>
                </div>
                
                <!-- Bid Form with Name Input -->
                <form id="bid-form-tv" onsubmit="event.preventDefault(); placeBid('tv')">
                    <input type="text" name="user_name" placeholder="Enter your name" required>
                    <input type="number" name="bid_amount" id="bid-amount-tv" placeholder="Enter your bid" min="1" required>
                    <button type="submit">Place Bid</button>
                </form>

                <!-- Display Bid History -->
                <h3>Bid History</h3>
                <ul id="bid-history-tv">
                    <!-- Example Bid History -->
                </ul>
            </div>

            <!-- Product 2 -->
            <div class="product" id="product-ipad">
                <h2>Item 2: iPad</h2>
                <p>Description: An Apple iPad.</p>
                <img src="/images/ipad.jpeg" alt="iPad" class="product-image">
                <p id="current-bid-ipad">Current Bid: <span>$1000</span></p>
                
                <div id="timer-ipad">
                    <span id="countdown-ipad"></span>
                </div>

                <!-- Bid Form with Name Input -->
                <form id="bid-form-ipad" onsubmit="event.preventDefault(); placeBid('ipad')">
                    <input type="text" name="user_name" placeholder="Enter your name" required>
                    <input type="number" name="bid_amount" id="bid-amount-ipad" placeholder="Enter your bid" min="1001" required>
                    <button type="submit">Place Bid</button>
                </form>

                <!-- Display Bid History -->
                <h3>Bid History</h3>
                <ul id="bid-history-ipad">
                    <!-- Example Bid History -->
                    <li>Ruth: $1000</li>
                </ul>
            </div>

             <!-- Product 3 -->
             <div class="product" id="product-tv">
                <h2>Item 3: Small Heater</h2>
                <p>Description: A small heater.</p>
                <img src="/images/heater.jpeg" alt="Television" class="product-image">
                <p id="current-bid-heater">Current Bid: <span>$0</span></p>
                
                <div id="timer-heater">
                    <span id="countdown-heater"></span>
                </div>
                
                <!-- Bid Form with Name Input -->
                <form id="bid-form-heater" onsubmit="event.preventDefault(); placeBid('heater')">
                    <input type="text" name="user_name" placeholder="Enter your name" required>
                    <input type="number" name="bid_amount" id="bid-amount-heater" placeholder="Enter your bid" min="1" required>
                    <button type="submit">Place Bid</button>
                </form>

                <!-- Display Bid History -->
                <h3>Bid History</h3>
                <ul id="bid-history-heater">
                    <!-- Example Bid History -->
                </ul>
            </div>

             <!-- Product 4 -->
             <div class="product" id="product-tv">
                <h2>Item 1: Heated Blanket</h2>
                <p>Description: Gray heated blanket you can plug into wall outlet. Has different modes of heat.</p>
                <img src="/images/" alt="Heated Blanket" class="product-image">
                <p id="current-bid-tv">Current Bid: <span>$0</span></p>
                
                <div id="timer-blanket">
                    <span id="countdown-tv"></span>
                </div>
                
                <!-- Bid Form with Name Input -->
                <form id="bid-form-blanket" onsubmit="event.preventDefault(); placeBid('blanket')">
                    <input type="text" name="user_name" placeholder="Enter your name" required>
                    <input type="number" name="bid_amount" id="bid-amount-blanket" placeholder="Enter your bid" min="1" required>
                    <button type="submit">Place Bid</button>
                </form>

                <!-- Display Bid History -->
                <h3>Bid History</h3>
                <ul id="bid-history-tv">
                    <!-- Example Bid History -->
                </ul>
            </div>

        </div>
    </div>

    <script>
        const { time } = require("console");

        // Countdown Timer for both items (Modified for specific end times)
        let timeLeftTv = 60; // 60 seconds for demo, adjust as needed for fallback
        let timeLeftIpad = 60;

        let countdownDisplayTv = document.getElementById("countdown-tv");
        let countdownDisplayIpad = document.getElementById("countdown-ipad");

        // Set the end date for TV auction to be February 14th, 2025, 7:00 PM
        const endDateTv = new Date("February 14, 2025 19:00:00");  // TV auction ends on February 14th at 7:00 PM

        function startCountdown() {
            // Countdown for the TV Auction (Set to specific end date)
            let countdownIntervalTv = setInterval(function () {
                const now = new Date();
                const timeLeftTv = endDateTv - now;  // Calculate remaining time

                if (timeLeftTv <= 0) {
                    clearInterval(countdownIntervalTv);
                    countdownDisplayTv.innerHTML = "Auction Ended!";
                    alert("Auction ended for Television!");
                } else {
                    const minutes = Math.floor((timeLeftTv % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((timeLeftTv % (1000 * 60)) / 1000);
                    countdownDisplayTv.innerHTML = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
                }
            }, 1000);

            // Countdown for the iPad Auction (fallback logic, adjust as necessary)
            let countdownIntervalIpad = setInterval(function () {
                let minutes = Math.floor(timeLeftIpad / 60);
                let seconds = timeLeftIpad % 60;

                countdownDisplayIpad.innerHTML = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;

                if (timeLeftIpad <= 0) {
                    clearInterval(countdownIntervalIpad);
                    alert("Auction ended for iPad!");
                }

                timeLeftIpad--;
            }, 1000);
        }

        startCountdown();

        // Place bid functionality for each item
        function placeBid(item) {
            let currentBidElement = document.getElementById(`current-bid-${item}`);
            let currentBid = parseInt(currentBidElement.getElementsByTagName('span')[0].innerText);
            let bidAmount = parseInt(document.getElementById(`bid-amount-${item}`).value);
            let userName = document.querySelector(`#bid-form-${item} input[name="user_name"]`).value;

            if (bidAmount > currentBid && userName !== '') {
                // Update the bid on the page
                currentBidElement.getElementsByTagName('span')[0].innerText = bidAmount;

                // Send the bid information using the backend (adjust server-side for this action)
                const templateParams = {
                    user_name: userName,
                    bid_amount: bidAmount,
                    item_name: item
                };

                // Assuming you're handling sending bid info to the server using fetch or XMLHttpRequest
                fetch('/submit-bid', {
                    method: 'POST',
                    body: JSON.stringify(templateParams),
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                .then(response => response.json())
                .then(data => {
                    console.log('Bid placed successfully', data);
                    alert('Bid placed successfully!');
                })
                .catch(error => {
                    console.error('Error placing bid:', error);
                    alert("Error placing your bid. Please try again.");
                });
            } else if (bidAmount <= currentBid) {
                alert("Your bid must be higher than the current bid.");
            } else if (userName === '') {
                alert("Please enter your name before bidding.");
            }
        }
    </script>
</body>
</html>
